generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// ==== Talent Database (MVP) ====
model Talent {
  id           Int       @id @default(autoincrement())
  userId       Int?
  fullName     String
  email        String    @unique
  phone        String?
  location     String?
  timezone     String?
  bio          String?
  designation  String?   // JobTitle/role e.g., CEO, Founder, CTO
  industry     String?   // Company name
  yearsExp     Int?      // total experience in years
  rateHourly   Float?
  rateDaily    Float?
  currency     String?   // e.g., INR, USD
  status       String    @default("active") // active | inactive | archived
  photoUrl     String?
  linkedinUrl  String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  user         User?     @relation(fields: [userId], references: [id], onDelete: SetNull)
  skills       TalentSkill[]
  experiences  Experience[]
  educations   Education[]
  certifications Certification[]
  portfolios   PortfolioItem[]
  assignments  Assignment[]
  feedbacks    Feedback[]
}

model Skill {
  id        Int      @id @default(autoincrement())
  key       String   @unique // normalized key e.g., javascript, react
  label     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  talents   TalentSkill[]
  roleRequirements RoleRequirement[]
}

model TalentSkill {
  talentId   Int
  skillId    Int
  level      Int?     // 1-5 proficiency
  lastUsedAt DateTime?

  talent     Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  skill      Skill    @relation(fields: [skillId], references: [id], onDelete: Cascade)

  @@id([talentId, skillId])
  @@index([skillId])
}

model Experience {
  id          Int      @id @default(autoincrement())
  talentId    Int
  company     String
  title       String
  startDate   DateTime
  endDate     DateTime?
  description String?

  talent      Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
}

model Education {
  id          Int      @id @default(autoincrement())
  talentId    Int
  institution String
  degree      String?
  startDate   DateTime?
  endDate     DateTime?

  talent      Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
}

model Certification {
  id          Int      @id @default(autoincrement())
  talentId    Int
  name        String
  issuer      String?
  issuedAt    DateTime?
  expiresAt   DateTime?

  talent      Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
}

model PortfolioItem {
  id          Int      @id @default(autoincrement())
  talentId    Int
  title       String
  url         String?
  mediaType   String?  // image | video | doc | link
  description String?

  talent      Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
}

model Role {
  id           Int      @id @default(autoincrement())
  title        String
  description  String?
  locationReq  String?  // remote | onsite | hybrid | city
  rateMin      Float?
  rateMax      Float?
  currency     String?
  experienceLv String?  // junior | mid | senior
  status       String   @default("open") // open | assigned | completed
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  requirements RoleRequirement[]
  assignments  Assignment[]
  feedbacks    Feedback[]
}

model RoleRequirement {
  id       Int   @id @default(autoincrement())
  roleId   Int
  skillId  Int
  level    Int?  // desired proficiency
  weight   Int?  // importance weight 1-5

  role     Role  @relation(fields: [roleId], references: [id], onDelete: Cascade)
  skill    Skill @relation(fields: [skillId], references: [id], onDelete: Cascade)

  @@index([roleId])
  @@index([skillId])
}

model Assignment {
  id         Int      @id @default(autoincrement())
  talentId   Int
  roleId     Int
  startDate  DateTime?
  endDate    DateTime?
  status     String   @default("active") // active | completed | cancelled
  notes      String?

  talent     Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  role       Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
}

model Feedback {
  id         Int      @id @default(autoincrement())
  talentId   Int
  roleId     Int?
  rating     Int      // 1-5
  comment    String?
  createdAt  DateTime @default(now())

  talent     Talent   @relation(fields: [talentId], references: [id], onDelete: Cascade)
  role       Role?    @relation(fields: [roleId], references: [id], onDelete: SetNull)
}

model User {
  id                Int                @id @default(autoincrement())
  email             String             @unique
  name              String?
  passwordHash      String?
  role              String             @default("founder")
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  emailVerified     DateTime?
  image             String?
  accounts          Account[]
  maListings        MAListing[]
  marketingRequests MarketingRequest[]
  sessions          Session[]
  startups          Startup[]
  talents           Talent[]
}

model Startup {
  id                 Int                 @id @default(autoincrement())
  name               String
  slug               String              @unique
  description        String?
  stage              String?
  sector             String?
  location           String?
  dpiitNumber        String?             @unique
  foundingYear       Int?
  teamSize           Int?
  revenue            Float?
  registeredAs       String?
  website            String?
  linkedin           String?
  userId             Int
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  autoApplyLogs      AutoApplyLog[]
  complianceRequests ComplianceRequest[]
  documents          Document[]
  maListings         MAListing[]
  marketingRequests  MarketingRequest[]
  serviceRequests    ServiceRequest[]
  agencyRequests     AgencyRequest[]
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Document {
  id         Int       @id @default(autoincrement())
  startupId  Int
  name       String
  fileUrl    String
  type       String
  status     String    @default("pending")
  notes      String?
  uploadedAt DateTime  @default(now())
  verifiedAt DateTime?
  startup    Startup   @relation(fields: [startupId], references: [id], onDelete: Cascade)
}

model GovtScheme {
  id                 Int       @id @default(autoincrement())
  schemeName         String    @unique
  ministry           String?
  department         String?
  category           String?
  benefitType        String?
  benefits           String?
  maxAssistance      String?
  amountRange        String?
  eligibility        String?
  sectors            String?
  region             String?
  applicationProcess String?
  officialLink       String?
  applicationLink    String?
  status             String?   @default("Active")
  description        String?
  criteria           String?
  deadline           DateTime?
  source             String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
}

model BankScheme {
  id                Int       @id @default(autoincrement())
  bankName          String
  schemeName        String
  type              String?   // government | private | venture_debt | overdraft | invoice_discount | working_capital
  minLoanAmount     Float?    // In rupees (keeping Float for compatibility)
  maxLoanAmount     Float?    // In rupees (keeping Float for compatibility)
  interestRate      String?   // e.g., "8-10%" or "Starting from 9%"
  tenure            String?   // e.g., "1-5 years"
  processingFees    String?
  eligibility       String?
  documentsRequired String?
  sectors           String?   // comma-separated list
  states            String?   // comma-separated list of states where available
  description       String?
  officialSource    String?
  status            String?   @default("Active") // Active | Inactive | Updated
  sourceFetchedAt   DateTime? // when this row was last fetched/updated automatically
  // Legacy fields (for backward compatibility)
  benefits          String?
  industry          String?   // Startup, MSME, FinTech, etc.
  state             String?   // Single state (deprecated, use states)
  region            String?   // National, North, South, etc.
  collateral        String?
  source            String?
  lastUpdatedBy     String?   // system | admin | cron
  updateNotes       String?
  officialLink      String?   // Legacy field
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

model Settings {
  id                Int       @id @default(autoincrement())
  key               String    @unique
  value             String?   // JSON string for complex values
  type              String    @default("string") // string | json | color | url
  category          String?   // branding | theme | general
  description       String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

// Optional dedicated branding settings (current app uses generic Settings with category='branding')
model BrandingSettings {
  id            Int      @id @default(autoincrement())
  startupId     Int?
  companyName   String?
  primaryColor  String?
  logoUrl       String?
  paletteJson   String?  // JSON string
  typography    String?
  status        String?  @default("in_progress") // in_progress | completed
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model FounderProfile {
  id              Int      @id @default(autoincrement())
  firstName       String
  lastName        String
  company         String?
  role            String?
  skills          String?
  experience      String?
  location        String?
  linkedin        String?
  portfolio       String?
  availability    String?
  email           String?  @unique
  phone           String?
  education       String?
  specializations String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// Recently Funded Startups (M&A module)
model FundedStartup {
  id                    Int       @id @default(autoincrement())
  name                  String
  industry              String?
  location              String?
  companySize           String?
  website               String?
  fundingStage          String?
  fundingAmount         String?
  fundingAmountNumeric  Float?
  foundedYear           Int?
  description           String?
  logoUrl               String?
  founderName           String?
  founderEmail          String?
  founderLinkedIn       String?
  investors             String?
  contactInfo           String?
  sourceUrl             String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([industry])
  @@index([location])
  @@index([fundingStage])
  @@index([foundedYear])
}

model PitchDeck {
  id          Int      @id @default(autoincrement())
  title       String
  companyName String?
  stage       String?
  category    String?
  industry    String?
  source      String?
  fileUrl     String
  thumbnail   String?
  pages       Int?
  textExtract String?
  uploadedBy  Int?
  workspaceId Int?
  verified    Boolean  @default(false)
  year        Int?
  description String?
  tags        String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model AutoApplyLog {
  id         Int      @id @default(autoincrement())
  startupId  Int
  schemeId   Int
  schemeType String
  status     String   @default("pending")
  payload    String?
  notes      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  startup    Startup  @relation(fields: [startupId], references: [id], onDelete: Cascade)
}

model DashboardStat {
  id        Int      @id @default(autoincrement())
  metric    String   @unique
  value     Int
  updatedAt DateTime @default(now())
}

model Subscription {
  id         Int       @id @default(autoincrement())
  userId     Int
  plan       String
  razorpayId String?   @unique
  status     String    @default("active")
  startedAt  DateTime  @default(now())
  expiresAt  DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @default(now()) @updatedAt
}

model Account {
  id                Int     @id @default(autoincrement())
  userId            Int
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           Int      @id @default(autoincrement())
  sessionToken String   @unique
  userId       Int
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int?
  title     String
  body      String
  link      String?
  level     String   @default("info")
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
}

// Branding/marketing contacts directory
model BrandingContact {
  id           Int       @id @default(autoincrement())
  organization String?
  firstName    String?
  lastName     String?
  designation  String?
  phone        String?
  email        String?   @unique
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@unique([organization, firstName, lastName])
}

model Agency {
  id              Int               @id @default(autoincrement())
  name            String
  slug            String?           @unique
  location        String?
  city            String?
  state           String?
  website         String?
  instagram       String?
  services        String?           // JSON string or comma list
  description     String?
  rating          Float?            @default(4.0)
  minBudget       Int?              @default(5000)
  portfolio       String?           // JSON string: list of {title,coverUrl,year}
  // legacy fields maintained for backward-compatibility
  category        String?
  portfolioUrls   String?
  contactEmail    String?
  maxBudget       Int?
  verified        Boolean           @default(false)
  expertiseTags   String?
  industries      String?
  teamSize        Int?
  yearsExperience Int?
  responseTime    String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  proposals       AgencyProposal[]
  requests        AgencyRequest[]
}

model Investor {
  id         Int      @id @default(autoincrement())
  name       String
  firm       String?
  stageFocus String?
  sectors    String?
  location   String?
  email      String?
  linkedin   String?
  createdAt  DateTime @default(now())
}

model ServiceRequest {
  id                 Int      @id @default(autoincrement())
  startupId          Int
  serviceType        String
  documents          String?
  paymentStatus      String   @default("pending")
  registrationStatus String   @default("initiated")
  razorpayOrderId    String?  @unique
  razorpayPaymentId  String?
  amount             Float?
  adminNotes         String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  startup            Startup  @relation(fields: [startupId], references: [id], onDelete: Cascade)
}

model ComplianceRequest {
  id                Int       @id @default(autoincrement())
  startupId         Int
  complianceType    String
  category          String
  documents         String?
  paymentStatus     String    @default("pending")
  progressStatus    String    @default("initiated")
  razorpayOrderId   String?   @unique
  razorpayPaymentId String?
  amount            Float?
  deadline          DateTime?
  notes             String?
  certificateUrl    String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  startup           Startup   @relation(fields: [startupId], references: [id], onDelete: Cascade)
}

model MAListing {
  id              Int          @id @default(autoincrement())
  type            String
  startupId       Int?
  userId          Int
  title           String
  description     String?
  industry        String?
  location        String?
  stage           String?
  revenue         Int?
  profit          Int?
  users           Int?
  askingPrice     Int?
  budgetMin       Int?
  budgetMax       Int?
  teamSize        Int?
  assets          String?
  pitchDeckUrl    String?
  documents       String?
  whySelling      String?
  status          String       @default("active")
  isApproved      Boolean      @default(false)
  adminNotes      String?
  views           Int          @default(0)
  interestedUsers String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  dealRooms       MADealRoom[]
  startup         Startup?     @relation(fields: [startupId], references: [id])
  user            User         @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model MADealRoom {
  id         Int       @id @default(autoincrement())
  listingId  Int
  user1      Int
  user2      Int
  messages   String?
  dealStatus String    @default("negotiating")
  documents  String?
  notes      String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  listing    MAListing @relation(fields: [listingId], references: [id], onDelete: Cascade)
}

model MarketingRequest {
  id                Int              @id @default(autoincrement())
  userId            Int
  startupId         Int?
  serviceType       String
  description       String?
  budgetMin         Int?
  budgetMax         Int?
  preferredStyle    String?
  timeline          String?
  documents         String?
  status            String           @default("pending")
  assignedAgency    Int?
  razorpayOrderId   String?          @unique
  razorpayPaymentId String?
  paymentStatus     String           @default("pending")
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  proposals         AgencyProposal[]
  startup           Startup?         @relation(fields: [startupId], references: [id])
  user              User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AgencyProposal {
  id           Int              @id @default(autoincrement())
  requestId    Int
  agencyId     Int
  // New fields per spec
  startupId    Int?
  price        Int
  timeline     String
  proposalText String?
  files        String?
  // Legacy fields for compatibility
  message      String?
  deliverables String?
  workPlan     String?
  status       String           @default("pending")
  acceptedAt   DateTime?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  agency       Agency           @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  // Backward compatibility with MarketingRequest; new AgencyRequest relation uses agencyRequestId
  request      MarketingRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  agencyRequestId Int?
  agencyRequest AgencyRequest? @relation(fields: [agencyRequestId], references: [id])
}

// Direct startup â†’ agency request for proposals
model AgencyRequest {
  id                Int       @id @default(autoincrement())
  agencyId          Int
  startupId         Int
  serviceType       String
  budget            Int?
  timeline          String?
  message           String?
  files             String?
  status            String    @default("pending") // pending | proposal_sent | accepted | declined | closed
  brandingCompleted Boolean   @default(false)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  agency            Agency    @relation(fields: [agencyId], references: [id], onDelete: Cascade)
  startup           Startup   @relation(fields: [startupId], references: [id], onDelete: Cascade)
  proposals         AgencyProposal[]
  messages          AgencyMessage[]
}

// Chat-style messaging per request
model AgencyMessage {
  id         Int      @id @default(autoincrement())
  requestId  Int
  senderId   Int
  senderType String   // startup | agency
  message    String?
  files      String?
  readAt     DateTime?
  createdAt  DateTime @default(now())
  request    AgencyRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
}

// Startup Challenge Module
model Challenge {
  id                Int               @id @default(autoincrement())
  slug              String            @unique
  title             String
  shortDesc         String?
  longDesc          String?
  thematicAreas     String?           // comma list or JSON
  startAt           DateTime
  submissionDeadline DateTime
  firstEvalAt       DateTime?
  secondEvalAt      DateTime?
  status            String            @default("draft") // draft|open|closed|evaluating|completed
  incentives        String?
  eligibilityJson   String?           // JSON string
  evaluationJson    String?           // JSON string
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  submissions       Submission[]
  invites           ChallengeInvite[]
}

model Submission {
  id                Int      @id @default(autoincrement())
  challengeId       Int
  companyName       String
  founders          String?  // JSON string
  entityType        String?
  operationalSince  DateTime?
  stage             String?
  description       String?
  technicalProposal String?
  deckUrl           String?
  sampleUrls        String?  // JSON string
  financials        String?  // JSON string
  location          String?
  submittedAt       DateTime @default(now())
  status            String   @default("received") // received|shortlisted|rejected|finalist|winner
  rawScore          Float?
  reviewCount       Int      @default(0)
  meta              String?  // JSON string
  challenge         Challenge @relation(fields: [challengeId], references: [id], onDelete: Cascade)
  reviews           Review[]
}

model Judge {
  id         Int      @id @default(autoincrement())
  name       String
  email      String   @unique
  bio        String?
  organisation String?
  createdAt  DateTime @default(now())
  reviews    Review[]
}

model Review {
  id           Int      @id @default(autoincrement())
  submissionId Int
  judgeId      Int
  scores       String   // JSON string
  totalScore   Float
  comments     String?
  submittedAt  DateTime @default(now())
  submission   Submission @relation(fields: [submissionId], references: [id], onDelete: Cascade)
  judge        Judge @relation(fields: [judgeId], references: [id], onDelete: Cascade)
}

model ChallengeInvite {
  id         Int      @id @default(autoincrement())
  challengeId Int
  email      String
  token      String   @unique
  role       String   // applicant|judge|partner
  createdAt  DateTime @default(now())
  used       Boolean  @default(false)
  challenge  Challenge @relation(fields: [challengeId], references: [id], onDelete: Cascade)
}
